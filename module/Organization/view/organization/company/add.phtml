<?php

$form = $this->form;
$param=$this->param;
$comContractUuid=$this->comContractUuid;
$form->setAttribute('action', $this->url('company', array('action' => 'createCompany', 'org_id' => $this->org_id,'id'=>$param, 'comId'=>$comContractUuid)))
    ->prepare();


$address=$form->get('address');
$contact=$form->get('contact');
echo $this->form()->openTag($form);
?>
<div class="companyAdd">
    <table class="table" style="width: 100%">

        <tr>
            <td width='50%'>
                <div class="address">
                    <?php
                    echo '<h1>'.$address->getLabel().'</h1>';
                    echo '<div class="template">'.$this->formCollection($address->getTemplateElement()).'</div>';
                    foreach($address as $collectionForm) {
                        echo '<fieldset>'.$this->formCollection($collectionForm).'</fieldset>';
                    } ?>
                </div>
                <button type="button" onclick="addItem('address');">Добавить еще адресс</button>
            </td>
            <td width='50%'>
                <div class="contact">
                    <?php
                    echo '<h1>'.$contact->getLabel().'</h1>';
                    echo '<div class="template">'.$this->formCollection($contact->getTemplateElement()).'</div>';
                    foreach($contact as $collectionForm) {
                        echo '<fieldset>'.$this->formCollection($collectionForm).'</fieldset>';
                    } ?>
                </div>
                <button type="button" onclick="addItem('contact');">Добавить контакт</button>
            </td>
        </tr>

        <tr>
            <td width='50%'>

            </td>
            <td width='50%'>

            </td>
        </tr>

        <tr>
            <td width='50%'>

            </td>
            <td width='50%'>

            </td>
        </tr>

    </table>
<?php


echo $this->formRow($form->get('name'));

// echo $this->formCollection()->renderTemplate($form->get('address'));
?>




    <script>
        function addItem(item) {
            var currentCount = $('.'+item+' .counter').val();
            if(typeof currentCount=== 'undefined') {
                $('.'+item).append("<input type='hidden' class='counter' value='1'>");
                currentCount=1;
            }
            var template=$('.'+item+' .template').html();
            template = template.replace(/__index__/g, currentCount);

            $('.'+item).append('<fieldset>'+template+'</fieldset>');
            currentCount++;
            $('.'+item+' .counter').val(currentCount);
        }
        function deleteFieldset(element) {
            var conf = confirm('Вы действительно хотите удалить элемент?');
            if (!conf) {
                return false;
            }
            else {
                $(element).parent().remove();
            }

        }

    </script>

    <?php


echo $this->formElement($form->get('submit'));
echo $this->form()->closeTag();
?>
</div>

<?php

?> <a href="<?php echo $this->url('account', array('action' => 'index')); ?>">Вернуться в аккаунт</a>
