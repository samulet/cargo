<?php
$tickets = $this->res;
$multiField = $this->multiField;

$form = $this->form;
$formsArray = $this->formsArray;
$formFilterWay = $formsArray[0]['formWay'];
$formFilterWayDoc = $formsArray[0]['formsDocArray'][0];

$types_r = array('Тентовый' => 'tent', 'Фургон' => 'furgon', 'Пикап' => 'pickup', 'Муковоз' => 'mukovoz');
?>
<h1>Резльтаты поиска</h1>
<a href="<?php echo $this->url(
    'ticket',
    array('action' => 'add')
);?>">Добавить заявку</a>
<a href="<?php echo $this->url(
    'ticket',
    array('action' => 'index')
);?>">Все заявки</a>

<table class="table">
    <tr>
        <?php if(!empty($multiField['ticket'])) {foreach($multiField['ticket'] as $field =>$value) { ?>
            <th><?php echo $form->get($field)->getLabel(); ?></th>
        <?php }} ?>
        <?php if(!empty($multiField['ticketWay'])) {foreach($multiField['ticketWay'] as $field  =>$value) { ?>
            <th><?php echo $formFilterWay->get($field)->getLabel(); ?></th>
        <?php } }?>
        <?php if(!empty($multiField['ticketWayDoc'])) {foreach($multiField['ticketWayDoc'] as $field  =>$value) { ?>
            <th><?php echo $formFilterWayDoc->get($field)->getLabel(); ?></th>
        <?php } }?>
    </tr>
    <?php foreach ($tickets as $ticket) {

     //   $ticketWay=$ticket['ways'];
      //  $cargo=$ticket['veh'];
       // $ticket=;

        ?>
        <tr>
            <?php if(!empty($multiField['ticket'])) {foreach($multiField['ticket'] as $field =>$value) { ?>
                <td><?php if(!empty($ticket['res'][$field])) {
                        if($field!='numberInt') {
                            echo $ticket['res'][$field];
                        } else {
                            ?>
                            <a href="<?php echo $this->url(
                                'ticket',
                                array('action' => 'add', 'id' => $ticket['res']['uuid'] ,'type'=>'list')
                            );?>"><?php echo $ticket['res'][$field]; ?></a>
                    <?php
                        }

                    } ?></td>
            <?php }} ?>
            <?php if(!empty($multiField['ticketWay'])) {foreach($multiField['ticketWay'] as $field =>$value) { ?>
                <td><?php
                    $counter=1;
                    foreach($ticket['ways'] as $way) {
                        if($field!='cargoOwner') {
                            if(!empty($way[$field])) {
                                echo '(Груз '.$counter.') '.$way[$field].'</br>';
                            }
                        } else {
                            if(!empty($way[$field])) {
                                echo '(Груз '.$counter.') '.$way['cargoOwnerTrue']['property'].' '.$way['cargoOwnerTrue']['name'].'</br>';
                            }
                        }
                        $counter++;
                    }
                    ?></td>
            <?php }} ?>
            <?php if(!empty($multiField['ticketWayDoc'])) {foreach($multiField['ticketWayDoc'] as $field =>$value) { ?>
                <td><?php
                    $counterWay=1;
                    foreach($ticket['ways'] as $way) {
                        $counterDoc=1;
                        if(!empty($way['docArray'])) {
                            foreach ($way['docArray'] as $doc) {
                                if(!empty($doc[$field])) {
                                    echo '(Груз '.$counterWay.' Док '.$counterDoc.') '.$doc[$field].'</br>';
                                }
                                $counterDoc++;
                            }
                        }
                        $counterWay++;
                    }
                    ?></td>
            <?php }} ?>
        </tr>
    <?php } ?>

</table>